<!DOCTYPE html>
<html>

<head>
    <title>Press-me button</title>

    <meta charset="UTF-8">
    <script src="jquery-3.6.0.min.js"></script>
    <script src = "api_url.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css">
</head>

<body>
    <div id="wrapper">
        <a href="#" class="my-super-cool-btn">
            <div class="dots-container">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            <span id="button-text"></span>
        </a>
    </div>
</body>

<script>
    $(document).ready(function () {
        var counter;
        //var api_url = "apigateway_url"
        var databody = '{"operation":"read","id":"1"}'
        $.ajax({
            type: 'POST',
            url: api_url,
            //headers: {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
            crossDomain: true,
            contentType: "application/json",
            data: databody,
            dataType: 'json',
            success: function (data) {
                var textstring = JSON.stringify(data.message.Item.counter.N);
                textstring = textstring.replace('"', '')
                textstring = textstring.replace('"', '')
                console.log(databody)
                document.getElementById("button-text").innerHTML = textstring;
            },
            error: function (responseData, textStatus, errorThrown) {
            }
        });
    });
    $( "#button-text" ).click(function() {
        //var api_url = "apigateway_url";
        var textstring = document.getElementById("button-text").innerHTML;
        if(textstring == ""){
            $.ajax({
                type: 'POST',
                url: api_url,
                //headers: {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
                crossDomain: true,
                contentType: "application/json",
                data: '{"operation":"write","id":"1", "counter":"1"}',
                dataType: 'json',
                success: function (data) {
                    document.getElementById("button-text").innerHTML = textstring;
                },
                error: function (responseData, textStatus, errorThrown) {
                    alert('POST failed.');
                }
            });
        }
        else {
            var textnum = parseInt(textstring) + 1;
            textstring = textnum.toString()
            var databody = '{"operation":"write","id":"1", "counter":"' + textstring + '"}';
            console.log(databody)
            $.ajax({
                type: 'POST',
                url: api_url,
                //headers: {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
                crossDomain: true,
                contentType: "application/json",
                data: databody,
                dataType: 'json',
                success: function (data) {
                    var textstring = JSON.stringify(data.message.Item.counter.N);
                    textstring = textstring.replace('"', '')
                    textstring = textstring.replace('"', '')
                    console.log(databody)
                    document.getElementById("button-text").innerHTML = textstring;
                },
                error: function (responseData, textStatus, errorThrown) {
                    alert('POST failed.');
                }
            });
        }

});
</script>